# DevOps Helper Scripts

Коллекция полезных скриптов для администрирования серверов и DevOps задач.

## Скрипты

### setup-ubuntu-user.sh

Скрипт для первоначальной настройки нового VPS с Ubuntu Server 24.04.3. Создает нового пользователя с sudo правами.

#### Возможности

- ✅ Создание нового пользователя с sudo правами
- ✅ Интерактивная настройка имени пользователя и пароля
- ✅ Опциональная настройка SSH ключей
- ✅ Аутентификация по паролю или только SSH-ключу
- ✅ Валидация ввода и обработка ошибок
- ✅ Цветной вывод для лучшей читаемости
- ✅ Проверки безопасности и подтверждения

#### Использование

**Способ 1: Прямой запуск с GitHub (рекомендуется)**

Запуск скрипта напрямую с GitHub без предварительного скачивания:

```bash
# Подключитесь к VPS от имени root
ssh root@ваш_ip_сервера

# Скачайте и выполните скрипт одной командой
curl -fsSL https://raw.githubusercontent.com/GAVProject/DevOps-Helper-Scripts/refs/heads/main/scripts/setup-ubuntu-user.sh | bash
```

**Способ 2: Скачивание с проверкой**

Для дополнительной безопасности можете сначала скачать и проверить скрипт:

```bash
# Скачайте скрипт
wget https://raw.githubusercontent.com/GAVProject/DevOps-Helper-Scripts/refs/heads/main/scripts/setup-ubuntu-user.sh

# Проверьте содержимое
cat setup-ubuntu-user.sh

# Сделайте исполняемым и запустите
chmod +x setup-ubuntu-user.sh
./setup-ubuntu-user.sh
```

#### Что делает скрипт

1. **Создание пользователя**: Создает нового пользователя с домашней директорией и bash оболочкой
2. **Sudo права**: Добавляет пользователя в группу sudo
3. **Настройка пароля**: Варианты аутентификации по паролю или только SSH-ключу
4. **Настройка SSH ключей**: Опциональная установка SSH публичного ключа
5. **Валидация**: Тестирует sudo доступ и предоставляет сводку

#### Функции безопасности

- Валидация формата имени пользователя
- Проверка существующих пользователей
- Правильные права доступа для SSH ключей
- Опция отключения аутентификации по паролю
- Подтверждение sudo доступа

#### Пример запуска

```bash
root@ubuntu-server:~# ./setup-ubuntu-user.sh

======================================
Скрипт настройки пользователя Ubuntu Server 24.04.3
======================================

[ИНФО] Создание нового пользователя с sudo правами

Введите имя пользователя: developer
Введите полное имя пользователя (необязательно): Developer User
Выберите способ настройки пароля:
1) Установить пароль сейчас
2) Отключить пароль (только SSH ключ)
Введите выбор (1-2): 1
Введите пароль для developer: 
Подтвердите пароль: 

Хотите добавить SSH публичный ключ? (y/n): y

[ИНФО] Создание пользователя 'developer'...
[УСПЕХ] Пароль установлен для пользователя 'developer'
[УСПЕХ] Пользователь 'developer' успешно создан
[ИНФО] Добавление пользователя 'developer' в группу sudo...
[УСПЕХ] Пользователь 'developer' добавлен в группу sudo
[ИНФО] Настройка SSH ключа для пользователя 'developer'...

Вставьте ваш SSH публичный ключ (или нажмите Enter для пропуска):
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7... user@local

[УСПЕХ] SSH ключ добавлен для пользователя 'developer'
[ИНФО] Тестирование sudo доступа для пользователя 'developer'...
[УСПЕХ] Sudo доступ подтвержден для пользователя 'developer'

======================================
[УСПЕХ] Настройка пользователя успешно завершена!
======================================

Данные пользователя:
  Имя пользователя: developer
  Домашняя директория: /home/developer
  Оболочка: /bin/bash
  Sudo доступ: Да
  Пароль: Установлен
  SSH ключ: Настроен

Следующие шаги:
1. Тестирование SSH подключения: ssh developer@ваш_ip_сервера
2. Тестирование sudo доступа: sudo whoami
3. Рассмотрите отключение SSH доступа для root в целях безопасности
```

## Требования

- Ubuntu Server 24.04.3
- Root доступ
- SSH доступ к серверу

## Рекомендации по безопасности

После создания пользователя рассмотрите эти дополнительные шаги безопасности:

1. **Отключите SSH доступ для root:**
   ```bash
   sudo nano /etc/ssh/sshd_config
   # Установите: PermitRootLogin no
   sudo systemctl restart sshd
   ```

2. **Включите аутентификацию только по SSH ключу:**
   ```bash
   sudo nano /etc/ssh/sshd_config
   # Установите: PasswordAuthentication no
   sudo systemctl restart sshd
   ```

3. **Обновите системные пакеты:**
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

4. **Настройте брандмауэр:**
   ```bash
   sudo ufw enable
   sudo ufw allow ssh
   ```